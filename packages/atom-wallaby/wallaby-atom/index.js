/*
 * wallaby-atom - v1.0.28
 * http://wallabyjs.com
 * Copyright (c) 2014-2016 Wallaby.js - All Rights Reserved.
 *
 * This source code file is a part of wallaby-atom and is a proprietary (closed source) software.

 * IMPORTANT:
 * Wallaby.js is a tool made by software developers for software developers with passion and love for what we do.
 * Pirating the tool is not only illegal and just morally wrong,
 * it is also unfair to other fellow programmers who are using it legally,
 * and very harmful for the tool and its future.
 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}var f="function"==typeof require&&require;module.exports=e(d[0])}({1:[function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a("atom"),g=function(){function b(){d(this,b)}return e(b,[{key:"activate",value:function(a){var c=this;this._state=a,this._disposables=new f.CompositeDisposable,this._disposables.add(atom.commands.add("atom-workspace",{"wallaby:show-command-palette":function(){return c._run("showCommandPalette")},"wallaby:toggle-panel":function(){return c._run("togglePanel")},"wallaby:focus-panel":function(){return c._run("togglePanel",!0)},"wallaby:start":function(){return c._run("start")},"wallaby:stop":function(){return c._run("stop")},"wallaby:run-project-tests":function(a){return c._run("runProjectTests")},"wallaby:show-last-screenshot":function(a){return c._run("showScreenshot")},"wallaby:show-license":function(a){return c._run("showLicense")},"wallaby:select-config-from-editor":function(a){return a.target&&a.target.getModel()&&a.target.getModel().getPath&&c._run("configFile",a.target.getModel().getPath())}})),this._disposables.add(atom.commands.add("atom-text-editor",{"wallaby:run-line-tests":function(a){return c._run("runLineTests",a.target.getModel())},"wallaby:run-file-tests":function(a){return c._run("runFileTests",a.target.getModel())},"wallaby:jump-to-failing-test":function(a){return c._run("jumpToFailingTest",a.target.getModel())},"wallaby:jump-to-error-source":function(a){return c._run("jumpToErrorSource",a.target.getModel())},"wallaby:toggle-uncovered-regions":function(a){return c._run("toggleUncovered",a.target.getModel())},"wallaby:show-line-tests":function(a){return c._run("showLineTests",a.target.getModel())}})),this._disposables.add(atom.commands.add(".tree-view .file",{"wallaby:select-config-from-tree":function(a){return c._run("configFile",a.target.dataset&&a.target.dataset.path||a.target.children.length&&a.target.children[0].dataset.path)}})),this._disposables.add({dispose:function(){global.wallaby&&global.wallaby.controller&&(global.wallaby.controller.deactivate(),delete global.wallaby.controller),delete global.wallaby}}),a.restore&&b._load(a,function(){})}},{key:"deactivate",value:function(){this._disposables.dispose()}},{key:"_run",value:function(a,c){b._load(this._state,function(){global.wallaby.controller[a](c)})}}],[{key:"_load",value:function(b,c){var d=b.load;return atom.project.getPaths()[0]?global.wallaby&&global.wallaby.controller?c():(d(function(c){global.wallaby=c,global.wallaby.controller=new(a("./lib/controller")),global.wallaby.controller.activate(b)}),void c()):void atom.notifications.addWarning("Please open some project before starting wallaby.js",{dismissable:!0})}}]),b}();c["default"]=new g,b.exports=c["default"]},{"./lib/controller":2,atom:void 0}],2:[function(a,b,c){function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;h=j=i=void 0,d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;return void 0===i?void 0:i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return void 0;a=j,b=f,c=g,d=!0}},i=a("path"),j=d(i),k=a("crypto"),l=d(k),m=a("atom"),n=a("./panelView"),o=d(n),p=a("./testsView"),q=d(p),r=a("./licenseView"),s=d(r),t=a("../"+(wallaby.debug?"../":"")+"wallaby/client"),u=t.Session,v=t.reportBuilder,w=t.utils,x=window.localStorage,y=wallaby.fsExtra,z=wallaby.statusBar,A=500,B=50,C=300,D=function(a){function b(){e(this,b),h(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return f(b,a),g(b,[{key:"activate",value:function(a){var c=this,d=this;a.updateAvailable=_.bind(this._updateAvailable,this),a.licensed=!1,this._packagePath=wallaby.packagePath,this._lkp=j["default"].join(this._packagePath,"..",".wlck"),this._phantomPath=wallaby.phantomPath,this._projectRoot=atom.project.getPaths()[0],d._statusElement=wallaby.$('<a tabindex="-1" href="#"/>'),d._statusElement.click(function(){return d.togglePanel()}),z&&(d._statusBarTile=z.addRightTile({item:d._statusElement[0],priority:Number.NEGATIVE_INFINITY})),this._configPath=x["wallaby:configPath:"+b._hash(this._projectRoot)],y.existsSync(this._configPath)||delete this._configPath,this._configPath=this._configPath||this._configByConvention(),this._configPath?this._setConfigFolderPath():this._notifyHowToSelectConfig(),this._disposables=new m.CompositeDisposable,this._disposables.add({dispose:function(){d.stop(),d._panelView&&(d._panelView.hide(),d._panelView.deactivate()),d._statusBarTile&&d._statusBarTile.destroy()}}),this.on("stopped",function(){return d._removeStatus()}),this.on("busy",function(){return d._updateStatus("progress")}),this.on("notification",function(a){var b=atom.notifications["add"+a.type.charAt(0).toUpperCase()+a.type.substr(1)](a.text,{dismissable:!0}),c=wallaby.$(atom.views.getView(b)),e=void 0;return c.on("mousedown",".activate-link",function(){d.showLicense(b)}),c.on("mousedown",".continue-trial-link",function(){b.dismiss(),d._continueTrial()}),e=b.onDidDismiss(function(){e&&e.dispose(),c.off("mousedown")}),b}),this.on("stats",function(a){var b=_.isString(a);!d._panelView&&b&&console.error("Wallaby Failing Tests: "+a),a&&(d._stats=a),d._updateStatus()}),this.on("filesToTrack",function(a,b){var d=c;_.reduce(b,function(a,b){return a[b]||(a[b]=Object.create(null)),a},a.filesInEditors),_.each(atom.workspace.getTextEditors(),function(b){return d._observeEditor(a,b)})}),this.on("live",function(a){return d._observeEditors(a)}),this.on("documentUpdates",function(a,b){return d._updateEditors(a,b)});var e=a.restore||{};!e.panelOpened||this._panelView&&this._panelView.isVisible()||this.togglePanel()}},{key:"_setConfigFolderPath",value:function(){this._configFolderPath=j["default"].dirname(this._configPath);try{this._configFolderPath=y.realpathSync(this._configFolderPath)}catch(a){}}},{key:"deactivate",value:function(){this._disposables.dispose()}},{key:"configFile",value:function(a){this._configPath=a,this._setConfigFolderPath(),x["wallaby:configPath:"+b._hash(this._projectRoot)]=this._configPath,this.emit("configFileSet",this._relativeConfigPath(a))}},{key:"togglePanel",value:function(a){var b=this,c=this;this._panelView?a?this._panelView.focusPanel():this._panelView.togglePanel():!function(){var d=b._panelView=new o["default"]({focus:a,configFilePath:b._relativeConfigPath(),starting:b._starting,started:b._started,stopped:!b._started&&!b._starting,failingTests:b._failingTests(),start:_.bind(b.start,b),stop:_.bind(b.stop,b),reportBuilder:v,navigate:_.bind(b._navigate,b)});atom.workspace.addBottomPanel({item:b._panelView}),b.on("starting",_.bind(d.starting,d)),b.on("stopped",_.bind(d.stopped,d)),b.on("configFileSet",_.bind(d.configFileSet,d)),b.on("stats",_.bind(d.failingTestsReport,d)),b.on("documentUpdates",function(){return d.failingTestsReport(c._failingTests())})}()}},{key:"showCommandPalette",value:function(){var a=atom.commands.findCommands;atom.commands.findCommands=function(){return a.apply(this,arguments).filter(function(a){return a.name&&a.name.startsWith("wallaby:")&&"wallaby:show-command-palette"!==a.name&&"wallaby:show-license"!==a.name&&!a.name.startsWith("wallaby:select-config-from")})},atom.commands.dispatch(atom.views.getView(atom.workspace),"command-palette:toggle"),atom.commands.findCommands=a}},{key:"showScreenshot",value:function(){this._session&&atom.workspace.open(j["default"].join(this._session.projectCachePath,"instrumented","screen.png"))}},{key:"runLineTests",value:function(a){this._runTests(a,!0)}},{key:"runFileTests",value:function(a){this._runTests(a)}},{key:"runProjectTests",value:function(){this._runTests()}},{key:"jumpToFailingTest",value:function(a){this._jumpTo(a,"failingTest")}},{key:"jumpToErrorSource",value:function(a){this._jumpTo(a,"errorSource")}},{key:"showLineTests",value:function(a,b){var c=this;if(this._session){var d=a.getPath();if(d){var e=this._relativeNormalizedFilePath(d);this._session.requestLineReport({file:e,line:b||a.getCursorBufferPosition().row+1},function(a){var b=new q["default"],d=atom.workspace.addModalPanel({item:b});b.display({reportBuilder:v,navigator:_.bind(c._navigate,c),blur:function(){return d.destroy()},data:a.report.tests&&a.report.tests.length?a.report:"Line is not covered or covered not by tests"}),setImmediate(function(){return b.focusView()})})}}}},{key:"start",value:function(){var a=this;if(this.stop(),!this._configPath)return void this._notifyHowToSelectConfig();var c=this._session=new u;c.disposables=new m.CompositeDisposable,c.filesInEditors=Object.create(null),c.partiallyTrackedEditors=Object.create(null),c.renderingQueue=Object.create(null),c.projectCachePath=j["default"].join(this._packagePath,"projects",b._hash(this._configPath)),c.start({localRoot:this._projectRoot,projectPath:c.projectCachePath,configPath:this._configPath,phantomPath:this._phantomPath,client:"Atom",lkp:this._lkp}),c.on("started",function(b){a._started=!0,delete a._starting,console.log("Wallaby Console: Started Wallaby.js Core v"+b.version),a.emit("started",b)}),c.on("stopped",function(b){a.stop(),b.deactivate&&atom.packages.getLoadedPackage("atom-wallaby").deactivate()}),c.on("expiredLicense",function(){delete wallaby.onFirstStart}),c.on("notification",function(b){return a.emit("notification",b)}),c.on("busy",function(){wallaby.onFirstStart&&(wallaby.onFirstStart(),delete wallaby.onFirstStart),a.emit("busy")}),c.on("stats",function(b){return a.emit("stats",b)}),c.on("filesToTrack",function(b){return a.emit("filesToTrack",c,b)}),c.on("live",function(b){return a.emit("live",c,b)}),c.on("documentUpdates",function(b){return a.emit("documentUpdates",c,b)}),c.on("navigationRequested",function(b){return a._navigate(b.file,b.loc)}),c.on("consoleError",function(a){try{a&&_.each(a.split("\n"),function(a){return a&&console.error("Wallaby Console: "+a)})}catch(b){}}),c.on("consoleLog",function(a){try{a&&_.each(a.split("\n"),function(a){return a&&console.log("Wallaby Console: "+a)})}catch(b){}}),this._starting=!0,this.emit("starting"),a._updateStatus("progress")}},{key:"stop",value:function(){var a=this._session;delete this._started,delete this._starting,delete this._session,delete this._stats,a&&(a.disposables&&a.disposables.dispose(),a.stop(),delete a.renderingQueue,delete a.filesInEditors,delete a.partiallyTrackedEditors,delete a.disposables,this.emit("stopped"),this._update&&this._update(this._currentState()))}},{key:"toggleUncovered",value:function(a,c){var d=!!a._wallabyUncoveredMarkers;b._destroyUncoveredMarkers(a),d||this._showUncovered(a,c)}},{key:"showLicense",value:function(a){var b=this,c=new s["default"],d=atom.workspace.addModalPanel({item:c});c.display({keyFilePath:this._lkp,parseKey:w.parseKey,closeView:function(c){d.destroy(),c&&(a&&a.dismiss(),b.stop())}}),setImmediate(function(){return c.focusView()})}},{key:"_updateAvailable",value:function(a){this._started?this._update=a:a(this._currentState())}},{key:"_currentState",value:function(){return{panelOpened:this._panelView&&this._panelView.isVisible()}}},{key:"_showUncovered",value:function(a,b){var c=this;if(this._session){var d=a.getPath();if(d){var e=this._relativeNormalizedFilePath(d);this._session.requestUncoveredRegions({file:e,line:b},function(b){return c._highlightUncovered(a,b.ranges)})}}}},{key:"_highlightUncovered",value:function(a,b){a._wallabyUncoveredMarkers=(a._wallabyUncoveredMarkers||[]).concat(_.map(b,function(b){var c=a.markBufferRange([[b[0]-1,b[1]],[b[2]-1,b[3]]],{persistent:!1,maintainHistory:!1,invalidate:"never"});return a.decorateMarker(c,{type:"highlight","class":"uncovered"}),c}))}},{key:"_jumpTo",value:function(a,b){var c=this;if(this._session){var d=a.getPath();if(d){var e=this._relativeNormalizedFilePath(d);this._session.requestLocation({file:e,line:a.getCursorBufferPosition().row+1,type:b},function(a){return c._navigate(a.file,a.loc)})}}}},{key:"_runTests",value:function(a,b){if(this._session){var c=void 0;if(a){var d=a.getPath();if(!d)return;c=this._relativeNormalizedFilePath(d)}this._session.runTests({file:a&&c,line:b&&a.getCursorBufferPosition().row+1})}}},{key:"_notifyHowToSelectConfig",value:function(){atom.notifications.addWarning("Please select wallaby.js configuration file from the file tree context menu or an opened configuration file editor context menu.",{dismissable:!0})}},{key:"_observeEditors",value:function(a){var b=this;a.disposables.add(atom.workspace.observeTextEditors(function(c){return b._observeEditor(a,c)}))}},{key:"_observeEditor",value:function(a,c){var d=this;if(!a.isDisposed()){var e=c.getPath();if(e)var f=d._relativeNormalizedFilePath(e),g=a.filesInEditors[f];var h=!e||!g;if(!(h&&a.partiallyTrackedEditors[c.id]||g&&g[c.id])){if(h)a.partiallyTrackedEditors[c.id]=!0;else{b._tryRemoveGutter(c);var i=c.addGutter({name:"wallaby"}),j=wallaby.$(atom.views.getView(i));j.on("click",".decoration",function(a){var b=a.target.children[0].dataset.line;d.showLineTests(c,b),d.toggleUncovered(c,b)}),delete a.partiallyTrackedEditors[c.id]}var k=new m.CompositeDisposable;h||(a.fileOpenedInEditor(f),g[c.id]=c,c._wallabyCoverageMarkers=Object.create(null),c._changes=[],c._changedCursorPositionAtLeastOnce=!1,c._wallabyLineMessagesCSS=document.createElement("style"),c._wallabyLineMessagesCSS.type="text/css",c._wallabyLineMessagesCSS._lines=0,c._wallabyLineMessagesHideCSS=document.createElement("style"),c._wallabyLineMessagesHideCSS.type="text/css",c._wallabyLineMessagesHideCSS._lines={},atom.views.getView(c).component.rootElement.parentNode.children[0].appendChild(c._wallabyLineMessagesCSS),atom.views.getView(c).component.rootElement.parentNode.children[0].appendChild(c._wallabyLineMessagesHideCSS),k.add({dispose:function(){j.off(),i.destroy()}}),k.add({dispose:function(){_.each(c._wallabyCoverageMarkers,function(a){return c.destroyMarker(a.id)}),b._destroyUncoveredMarkers(c),delete c._wallabyCoverageMarkers,delete c._wallabyLineMessagesCSS,delete c._wallabyLineMessagesHideCSS,delete c._changes,delete a.renderingQueue[c.id]}}),k.add(c.onDidStopChanging(function(e){b._destroyUncoveredMarkers(c),a.isDisposed()||!c._changes.length||e&&e.changes&&!e.changes.length&&!c._changedCursorPositionAtLeastOnce||(clearTimeout(d._statusUpdateTimeout),d._statusUpdateTimeout=setTimeout(function(){return d._updateStatus("progress")},C),a.fileChangedInEditor(f,c.getBuffer().getText(),{start:_.chain(c._changes).map(function(a){return a.start}).min().value()+1,end:_.chain(c._changes).map(function(a){return a.end}).max().value()+1}),c._changes=[])})),k.add(c.onDidChangeCursorPosition(function(){c._changedCursorPositionAtLeastOnce=!0})),k.add(c.onDidChange(function(d){a.isDisposed()||(c._changes.push(d),c._changedCursorPositionAtLeastOnce&&b._hideInlineMessages(d,c))}))),k.add(c.onDidChangePath(function(){a.isDisposed()||(!h||a.partiallyTrackedEditors[c.id])&&(c.save(),n.dispose(),d._observeEditor(a,c))}));var l={dispose:function(){c.disposables.remove(n),k.dispose()}},n={dispose:function(){a.disposables.remove(l),c.disposables.remove(n),k.dispose(),h?delete a.partiallyTrackedEditors[c.id]:(!a.isDisposed()&&a.fileClosedInEditor(f),delete g[c.id])}};a.disposables.add(l),c.disposables.add(n)}}}},{key:"_failingTests",value:function(){return this._stats}},{key:"_updateStatus",value:function(a){clearTimeout(this._statusUpdateTimeout),a||(a=_.isString(this._stats)?"failing":this._stats?this._stats.failingNumber||this._stats.errors.length?"failing":"passing":void 0),a&&(this._statusElement.removeClass(),this._statusElement.addClass("wallaby-status "+a))}},{key:"_continueTrial",value:function(){this._session&&this._session.continueTrial()}},{key:"_removeStatus",value:function(){this._statusElement.removeClass()}},{key:"_updateEditors",value:function(a,c){var d=this;_.each(_.sortBy(_.reduce(c,function(b,c,d){return b.concat(_(a.filesInEditors[d]).values().map(function(a){return{editor:a,update:c}}).value())},[]),function(a){return!b._isEditorVisible(a.editor)}),function(b){return d._updateEditor(a,b.editor,b.update)})}},{key:"_updateEditor",value:function(a,c,d){var e=this;b._destroyUncoveredMarkers(c);var f=a.renderingQueue[c.id]=a.renderingQueue[c.id]||{editor:c,operations:[]};d.fullUpdate&&(_.each(c._wallabyCoverageMarkers,function(a){return c.destroyMarker(a.id)}),c._wallabyCoverageMarkers=Object.create(null),f.operations=[]);var g=0;_.each(d.lines,function(a){g++;var b=c._wallabyCoverageMarkers[a.id],d=!1;b?a.del?(f.operations.push({editor:c,type:"delete",id:b.id,line:a}),d=!1):a.changed||a.num!==b.getBufferRange().start.row+1?(f.operations.push({editor:c,type:"delete",id:b.id,line:a}),d=!0):d=!1:a.del?(f.operations.push({editor:c,type:"delete",line:a}),d=!1):d=!0,d&&f.operations.push({editor:c,type:"create",line:a})}),d.allLines&&c._wallabyLineMessagesCSS._lines>g&&b._cleanUpLineMessagesCss(c),e._processMarkerOperationQueue(a)}},{key:"_navigate",value:function(a,b){if(a){var c=this._absoluteFilePath(a),d=void 0,e=void 0;_.isNumber(b)?d=b:_.isArray(b)?(d=b[0],e=b[1]):_.isString(b)&&(b=b.split(":"),d=b[0]&&parseInt(b[0],10),e=b[1]&&parseInt(b[1],10)),_.isNumber(d)?d-=1:d=void 0,_.isNumber(e)||(e=void 0),atom.workspace.open(c,{initialLine:d,initialColumn:e})}}},{key:"_relativeConfigPath",value:function(){return this._configPath&&j["default"].relative(this._projectRoot,this._configPath)}},{key:"_absoluteFilePath",value:function(a){return this._configFolderPath&&j["default"].resolve(this._configFolderPath,a)}},{key:"_relativeNormalizedFilePath",value:function(a){return this._configFolderPath&&w.normalizePath(j["default"].relative(this._configFolderPath,a))}},{key:"_configByConvention",value:function(){var a=this;return _.chain(["wallaby.js","wallaby.conf.js","wallaby.json"]).map(function(b){return j["default"].join(a._projectRoot,b)}).find(function(a){return y.existsSync(a)}).value()}},{key:"_processMarkerOperationQueue",value:function(a){if(!a.isDisposed()&&_.size(a.renderingQueue)){var c=_.find(a.renderingQueue,function(a){return b._isEditorVisible(a.editor)})||_.values(a.renderingQueue)[0],d=c.editor,e=c.operations.splice(0,A);e.length&&(d._wallabyLineMessagesCSS.innerHTML+=_.reduce(e,function(a,c){var e=b._performMarkerOperation(d,c);return _.isString(e)&&(a+=e,d._wallabyLineMessagesCSS._lines++),a},"")),c.operations.length||delete a.renderingQueue[c.editor.id],_.size(a.renderingQueue)||d._changes&&d._changes.length||b._resetHideCSS(d);var f=Math.floor(B*(e.length/A));setTimeout(_.bind(this._processMarkerOperationQueue,this,a),f)}}}],[{key:"_tryRemoveGutter",value:function(a){try{var b=a.gutterWithName("wallaby");b&&b.destroy()}catch(c){}}},{key:"_hideInlineMessages",value:function(a,c){if(c===atom.workspace.getActiveTextEditor()){for(var d="",e=Math.min(a.start,a.end),f=Math.min(e+5,Math.max(a.start,a.end)),g=e;f>=g;g++)_.each(c.findMarkers({startBufferRow:g}),function(a){a._lineId&&!c._wallabyLineMessagesHideCSS._lines[a._lineId]&&(d+=b._lineWithoutMessage(a._lineId),c._wallabyLineMessagesHideCSS._lines[a._lineId]=!0)});d&&(c._wallabyLineMessagesHideCSS.innerHTML+=d)}}},{key:"_destroyUncoveredMarkers",value:function(a){_.each(a._wallabyUncoveredMarkers,function(b){return a.destroyMarker(b.id)}),delete a._wallabyUncoveredMarkers}},{key:"_isEditorVisible",value:function(a){return wallaby.$(atom.views.getView(a)).isVisible()}},{key:"_hash",value:function(a){return l["default"].createHash("md5").update(a).digest("hex").substr(0,16)}},{key:"_resetHideCSS",value:function(a){a._wallabyLineMessagesHideCSS.innerHTML="",a._wallabyLineMessagesHideCSS._lines={}}},{key:"_cleanUpLineMessagesCss",value:function(a){var b=Object.create(null),c=0,d=(a._wallabyLineMessagesCSS.innerHTML||"").split("\n");d.reverse(),_.each(d,function(d){try{if(!d)return;var e=parseInt(d.substring(3,d.indexOf(":")),10);!b[e]&&a._wallabyCoverageMarkers[e]&&(b[e]=d,c++)}catch(f){}}),a._wallabyLineMessagesCSS.innerHTML=_.reduce(b,function(a,b){return a+=b+"\n"},""),a._wallabyLineMessagesCSS._lines=c}},{key:"_performMarkerOperation",value:function(a,c){var d=c.id,e=c.line;switch(c.type){case"create":var f=a.markBufferPosition([e.num-1,0],{persistent:!1,maintainHistory:!1,invalidate:"never"});f._lineId=e.id,a._wallabyCoverageMarkers[e.id]=f;var g=document.createElement("span");g.setAttribute("data-line",e.num),a.gutterWithName("wallaby").decorateMarker(f,{"class":"wallaby-cov-"+e.state,item:g});var h=b._lineMessageCss(e);if(h)return a.decorateMarker(f,{type:"line","class":"wl"+(e.err?"e":"c")}),a.decorateMarker(f,{type:"line","class":"wl"+e.id}),h;break;case"delete":if(!d){var i=a._wallabyCoverageMarkers[e.id];i&&(d=i.id)}_.isUndefined(d)||(a.destroyMarker(d),delete a._wallabyCoverageMarkers[e.id])}}},{key:"_lineMessageCss",value:function(a){if(a.err||a.log){var c=b._cssEscape(a.err||a.log);return".wl"+a.id+'::after{content:"   '+c+'";}\n'}}},{key:"_lineWithoutMessage",value:function(a){return".wl"+a+'::after{content:"";}\n'}},{key:"_cssEscape",value:function(a){for(var b,c=String(a),d=c.length,e=-1,f="",g=c.charCodeAt(0);++e<d;)b=c.charCodeAt(e),f+=b>=1&&31>=b||127==b||0==e&&b>=48&&57>=b||1==e&&b>=48&&57>=b&&45==g?"\\"+b.toString(16)+" ":b>=128||45==b||95==b||b>=48&&57>=b||b>=65&&90>=b||b>=97&&122>=b?c.charAt(e):"\\"+c.charAt(e);return f}}]),b}(EventEmitter);c["default"]=D,b.exports=c["default"]},{"./licenseView":3,"./panelView":4,"./testsView":5,atom:void 0,crypto:void 0,path:void 0}],3:[function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;h=j=i=void 0,d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;return void 0===i?void 0:i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return void 0;a=j,b=f,c=g,d=!0}},h=a("atom"),i=(wallaby.$,wallaby.View),j=wallaby.TextEditorView,k=wallaby.fsExtra,l=["January","February","March","April","May","June","July","August","September","October","November","December"],m=function(a){function b(){d(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return e(b,a),f(b,[{key:"display",value:function(a){var c=this;this._disposables=new h.CompositeDisposable;var d=function(b){c._disposables.dispose(),delete c._disposables,a.closeView(b)},e=this.licenseKey.model;this.cancelButton.click(function(){return d()}),this.saveButton.click(function(){var f=c._originalLicenseKey,g=e.getText()||"",h=!!b._parseKey(f,a.parseKey),i=!!b._parseKey(g,a.parseKey),j=!1;if(i||!g&&h)try{k.writeFileSync(a.keyFilePath,g),j=i}catch(l){atom.notifications.addError(l.message,{dismissable:!0}),j=!1}d(j)}),this._originalLicenseKey="";try{this._originalLicenseKey=k.readFileSync(a.keyFilePath).toString()}catch(f){}this._originalLicenseKey.length>100&&(e.setText(this._originalLicenseKey),this._updateLicenseDetails(e,a.parseKey)),this._disposables.add(e.onDidChange(function(){return c._updateLicenseDetails(e,a.parseKey)}))}},{key:"_updateLicenseDetails",value:function(a,c){var d=b._parseKey(a.getText(),c);if(this.licensee.text(""),this.expiration.text(""),d){this.licensee.text(d.licensee);var e=d.expiration;try{var f=d.expiration.split("/");3===f.length&&(e=new Date(f[1]+"/"+f[0]+"/"+f[2]),e=e.getDate()+" "+l[e.getMonth()]+" "+e.getFullYear())}catch(g){}this.expiration.text(e)}}},{key:"focusView",value:function(){this.licenseKey.focus()}}],[{key:"content",value:function(){var a=this;return a.div({"class":"block"},function(){a.div({"class":"block"},function(){a.span("Registered to: "),a.span({outlet:"licensee","class":"text-success"},"")}),a.div({"class":"block"},function(){a.span("Free upgrades until: "),a.span({outlet:"expiration","class":"text-success"},"")}),a.div({"class":"block"},function(){a.label("License key:"),a.subview("licenseKey",new j({mini:!0}))}),a.div({"class":"block"},function(){a.button({"class":"btn inline-block",outlet:"saveButton"},"Apply"),a.button({"class":"btn inline-block",outlet:"cancelButton"},"Cancel")})})}},{key:"_parseKey",value:function(a,b){if(_.isString(a))try{var c=b(a);if(c.licenseeName&&c.expirationDateString&&(~c.licensedProduct.indexOf("(Freedom)")||~c.licensedProduct.indexOf("(Atom)")))return{licensee:c.licenseeName,expiration:c.expirationDateString}}catch(d){return void 0}}}]),b}(i);c["default"]=m,b.exports=c["default"]},{atom:void 0}],4:[function(a,b,c){function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;h=j=i=void 0,d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;return void 0===i?void 0:i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return void 0;a=j,b=f,c=g,d=!0}},i=a("atom"),j=a("./testsView"),k=d(j),l=wallaby.$,m=wallaby.View,n=100,o=function(a){function b(){e(this,b),h(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return f(b,a),g(b,[{key:"initialize",value:function(a){var b=this,c=_.bind(this._displayFailingTests,this);this._displayFailingTests=_.debounce(c,n),this._disposables=new i.CompositeDisposable;var d=_.bind(this._resize,this);this.on("mousedown",".wallaby-panel-view-resizer",function(){l(document).on("mousemove",d),l(document).one("mouseup",function(){l(document).off("mousemove",d),delete b._lastClientY})}),this._params=a||{},this.configHintLabel.hide(),this.configFileSet(a.configFilePath),this.startButton.off(),this.startButton.click(this._params.start),this.stopButton.click(this._params.stop),this.hideButton.click(_.bind(this.togglePanel,this)),this._disposables.add(atom.tooltips.add(this.startButton,{title:"Start/Restart wallaby.js configuration",keyBindingCommand:"wallaby:start",trigger:"hover"})),this._disposables.add(atom.tooltips.add(this.stopButton,{title:"Stop wallaby.js configuration",keyBindingCommand:"wallaby:stop",trigger:"hover"})),this._disposables.add(atom.tooltips.add(this.hideButton,{title:"Toggle wallaby.js panel",keyBindingCommand:"wallaby:toggle-panel",trigger:"hover"})),a.configFilePath?this._params.stopped?this.stopped():this.starting():this._disableControlButtons(),this._displayFailingTests(this._params.focus)}},{key:"togglePanel",value:function(a){this.toggle(),this._displayFailingTests(a)}},{key:"focusPanel",value:function(){this.isVisible()?this.failingTests.focusView():this.togglePanel(!0)}},{key:"deactivate",value:function(){this._disposables.dispose()}},{key:"starting",value:function(){this.stopButton.removeClass("inactive"),this.stopButton.click(this._params.stop)}},{key:"stopped",value:function(){this.stopButton.addClass("inactive"),this.stopButton.off(),this.testNumberLabel.text(""),this.failingTests.clearView()}},{key:"_disableControlButtons",value:function(){this.startButton.addClass("inactive"),this.stopButton.addClass("inactive"),this.startButton.off(),this.stopButton.off()}},{key:"configFileSet",value:function(a){this.configLabel.text("Configuration: "+a),a?(this.configLabel.show(),this.configHintLabel.hide(),this.testNumberLabel.show(),this.startButton.removeClass("inactive"),this.startButton.off(),this.startButton.click(this._params.start)):(this.configLabel.hide(),this.testNumberLabel.hide(),this.configHintLabel.show(),this._disableControlButtons())}},{key:"failingTestsReport",value:function(a){this._params.failingTests=a,this._displayFailingTests()}},{key:"_displayFailingTests",value:function(a){var b=this._params.failingTests;this.isVisible()&&b&&(_.isObject(b)&&this.testNumberLabel.text(b.failingNumber+" failing tests, "+(b.totalNumber-b.failingNumber)+" passing"),this.failingTests.display({reportBuilder:this._params.reportBuilder,navigator:this._params.navigate,data:b,focus:a,failingTests:!0}))}},{key:"_resize",value:function(a){if(1===a.which){if(this._lastClientY){var b=this.height(),c=this._lastClientY-a.clientY;(0>c||c>0&&a.clientY<=this.offset().top)&&this.height(b+c)}this._lastClientY=a.clientY}}}],[{key:"content",value:function(){var a=this;return a.div({"class":"wallaby-panel-view"},function(){a.div({"class":"wallaby-panel-view-resizer"}),a.div({"class":"wallaby-panel-view-container"},function(){a.header({"class":"wallaby-panel-view-header header"},function(){a.span({"class":"header-item description",outlet:"configLabel"}),a.span({"class":"header-item subtle-info-message",outlet:"testNumberLabel"}),a.span({"class":"header-item subtle-info-message",outlet:"configHintLabel"},"Select configuration file from the project file tree or an opened editor context menu"),a.span({"class":"header-item icons pull-right inline-block btn-group"},function(){a.button({"class":"btn inline-block-tight icon icon-playback-play",tabindex:-1,outlet:"startButton"},"Start"),a.button({"class":"btn inline-block-tight icon icon-primitive-square",tabindex:-1,outlet:"stopButton"},"Stop"),a.button({"class":"btn inline-block-tight icon icon-x",tabindex:-1,outlet:"hideButton"},"Hide")})}),a.section({"class":"wallaby-panel-view-content"},function(){return a.subview("failingTests",new k["default"])})})})}}]),b}(m);c["default"]=o,b.exports=c["default"]},{"./testsView":5,atom:void 0}],5:[function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);
a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;h=j=i=void 0,d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;return void 0===i?void 0:i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return void 0;a=j,b=f,c=g,d=!0}},h=a("atom"),i=wallaby.$,j=wallaby.View,k=function(a){function b(){d(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return e(b,a),f(b,[{key:"display",value:function(a){var b=this,c=a.reportBuilder,d=a.navigator,e=a.blur,f=a.data,g=a.focus||a.showAll,h=a.failingTests,j=20,k=this;this.clearView();var l=[];!a.showAll&&f&&f.tests&&f.tests.length>j&&(l=f.tests.splice(j,1/0),a.showAll=!0),this.html(c.tests(f,h)+(l.length?'<a class="all btn inline-block">Show all tests</a>':"")),l.length&&(f.tests=f.tests.concat(l))&&this.on("mousedown","a.all",function(a){return b.attr("contenteditable",!1)})&&this.on("click","a.all",function(c){return b.attr("contenteditable",!0)&&k.display(a)}),this.on("click","a.loc",function(a){var b=i(a.target);d(b.data("file"),b.data("loc"))}),this.on("cut",function(a){return a.preventDefault()}),this.on("paste",function(a){return a.preventDefault()}),this.on("focus",function(a){return k._range&&document.getSelection().addRange(k._range)}),this.on("blur",function(a){try{var b=document.getSelection();k._range=b&&b.getRangeAt(0)}catch(a){delete k._range}k._disposables&&(k._disposables.dispose(),delete k._disposables),e&&e()}),this.on("keydown",function(a){switch(a.which){case 13:var b=document.getSelection().anchorNode;return b&&(b=3==b.nodeType?b.parentNode:b)?(b=i(b),(b.hasClass("loc")||b.hasClass("all"))&&b.click(),!1):!1;case 27:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 17:case 91:return!0;default:if((a.keyCode==="C".charCodeAt(0)||a.keyCode==="A".charCodeAt(0))&&(a.ctrlKey||a.metaKey))return!0}return!1}),g&&this.focusView()}},{key:"focusView",value:function(){this.is(":empty")||(this.focus(),this._disposables=new h.CompositeDisposable,this._disposables.add(atom.commands.add(".wallaby-tests-view",{"tool-panel:unfocus":function(){return atom.workspace.getActivePane().activate()}})))}},{key:"clearView",value:function(){this.off(),this.empty(),delete this._range,this._disposables&&(this._disposables.dispose(),delete this._disposables)}}],[{key:"content",value:function(){var a=this;return a.div({"class":"wallaby-tests-view native-key-bindings",tabindex:-1,contenteditable:!0})}}]),b}(j);c["default"]=k,b.exports=c["default"]},{atom:void 0}]},{},[1]);